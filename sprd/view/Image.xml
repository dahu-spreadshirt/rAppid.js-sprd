<ui:View xmlns="http://www.w3.org/1999/xhtml"
         xmlns:ui="js.ui" xmlns:js="js.core"
         src="{imageUrl()}" alt="{alt()}" onload="onLoad">

    <js:Imports>
        underscore;
    </js:Imports>

    <js:Script>

        <![CDATA[
        (function (_) {
            return {
                $exceptionSizes: [120, 178],
                defaults: {
                    tagName: "img",
                    loaded: false
                },
                onLoad: function () {
                    this.set('loaded', true);
                },
                normalizeSize: function (size) {

                    if (_.indexOf(this.$exceptionSizes, size) === -1) {
                        // normalize size
                        size = Math.ceil(size / 50) * 50;
                    }

                    // keep range
                    return Math.max(50, Math.min(1200, size));
                },
                extendUrlWithSizes: function (url) {
                    if (this.$.width) {
                        url += ",width=" + this.normalizeSize(this.$.width);
                    }

                    if (this.$.height) {
                        url += ",height=" + this.normalizeSize(this.$.height);
                    }

                    return url;
                },
                imageUrl: function () {
                    return "";
                },
                _renderLoaded: function (loaded) {
                    if (loaded) {
                        this.removeClass('loading');
                    } else {
                        this.addClass('loading');
                    }
                },
                alt: function () {
                    return "";
                }

            }
        })
        ]]>

    </js:Script>
</ui:View>